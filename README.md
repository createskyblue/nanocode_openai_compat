# nanocode_openai_compat

ä¸€ä¸ªæ”¯æŒå·¥å…·è°ƒç”¨çš„ OpenAI å…¼å®¹ API Agentï¼Œå‚è€ƒäº† [nanocode](https://github.com/1rgs/nanocode)ã€‚

## ç®€ä»‹

æœ¬é¡¹ç›®æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ OpenAI å…¼å®¹ API æ„å»ºä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å®Œæ•´çš„ AI Agentï¼Œæ”¯æŒå·¥å…·/å‡½æ•°è°ƒç”¨ã€‚å®ƒå®ç°äº†ä¸ Claude Code å’ŒåŸå§‹ nanocode ç±»ä¼¼çš„åŒé‡å¾ªç¯æ¶æ„ï¼ˆå¤–å¾ªç¯å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œå†…å¾ªç¯æ‰§è¡Œå·¥å…·è°ƒç”¨ï¼‰ã€‚

## ç‰¹æ€§

- **OpenAI å…¼å®¹ API**ï¼šæ”¯æŒ OpenAIã€Claudeï¼ˆé€šè¿‡ä»£ç†ï¼‰æˆ–æœ¬åœ° LLM æœåŠ¡å™¨
- **å·¥å…·è°ƒç”¨**ï¼šå†…ç½® 6 ä¸ªæ–‡ä»¶å’Œç³»ç»Ÿæ“ä½œå·¥å…·
- **åŒé‡å¾ªç¯æ¶æ„**ï¼šå¤–å¾ªç¯å¤„ç†ç”¨æˆ·å¯¹è¯ï¼Œå†…å¾ªç¯æ”¯æŒå¤šæ­¥å·¥å…·æ‰§è¡Œ
- **ç¯å¢ƒé…ç½®**ï¼šè‡ªåŠ¨ä» `.env` æ–‡ä»¶åŠ è½½é…ç½®
- **è·¨å¹³å°**ï¼šæ”¯æŒ Windowsã€macOS å’Œ Linux

## å·¥å…·åˆ—è¡¨

| å·¥å…· | è¯´æ˜ |
|------|------|
| `read` | è¯»å–æ–‡ä»¶å¹¶æ˜¾ç¤ºè¡Œå· |
| `write` | å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ |
| `edit` | æ›¿æ¢æ–‡ä»¶ä¸­çš„æ–‡æœ¬ï¼ˆæ”¯æŒå”¯ä¸€åŒ¹é…æ£€æŸ¥ï¼‰ |
| `glob` | æŒ‰æ¨¡å¼æŸ¥æ‰¾æ–‡ä»¶ï¼ŒæŒ‰ä¿®æ”¹æ—¶é—´æ’åº |
| `grep` | ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡ä»¶å†…å®¹ |
| `bash` | æ‰§è¡Œ shell å‘½ä»¤ï¼ˆæ”¯æŒ Windows ä¸­æ–‡ç¼–ç ï¼‰ |

## å®‰è£…

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# 2. å®‰è£…ä¾èµ–
uv pip install -r requirements.txt
```

## é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# OpenAI API
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_API_KEY=sk-your-api-key
OPENAI_MODEL=gpt-4o-mini

# æˆ–ä½¿ç”¨ Claude ä»£ç†
# OPENAI_BASE_URL=https://your-proxy.com/v1
# OPENAI_API_KEY=your-key
# OPENAI_MODEL=claude-3-sonnet-20240229

# æˆ–ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼ˆå¦‚ Ollamaã€vLLMï¼‰
# OPENAI_BASE_URL=http://localhost:8000/v1
# OPENAI_API_KEY=not-needed
# OPENAI_MODEL=llama2
```

## ä½¿ç”¨

```bash
uv run agent.py
```

### äº¤äº’å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `<æ¶ˆæ¯>` | å‘ Agent å‘é€æ¶ˆæ¯ |
| `/clear` | æ¸…ç©ºå¯¹è¯å†å² |
| `/tools` | åˆ—å‡ºå¯ç”¨å·¥å…· |
| `/quit` æˆ– `exit` | é€€å‡ºåº”ç”¨ |

### ä½¿ç”¨ç¤ºä¾‹

```
ğŸ‘¤ ç”¨æˆ·: è¯»å– agent.py çš„å‰ 20 è¡Œ

[å·¥å…·è°ƒç”¨ç¬¬ 1 è½®]
  ğŸ”§ read({"path": "agent.py", "limit": 20})
  ğŸ“¤ ç»“æœ: 1 | #!/usr/bin/env python3
        2 | """
        ...

ğŸ¤– Agent: è¿™æ˜¯ agent.py çš„å‰ 20 è¡Œ...
```

```
ğŸ‘¤ ç”¨æˆ·: æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ Python æ–‡ä»¶

[å·¥å…·è°ƒç”¨ç¬¬ 1 è½®]
  ğŸ”§ glob({"pat": "*.py", "path": "."})
  ğŸ“¤ ç»“æœ: ./agent.py | 1771659216.89

ğŸ¤– Agent: æ‰¾åˆ° 1 ä¸ª Python æ–‡ä»¶ï¼šagent.py
```

## æ¶æ„

### åŒé‡å¾ªç¯è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å¤–å¾ªç¯                             â”‚
â”‚  while True:                                            â”‚
â”‚      user_input = input("ç”¨æˆ·: ")  â† é˜»å¡ç­‰å¾…è¾“å…¥        â”‚
â”‚      response = agent.chat(user_input)                  â”‚
â”‚      print("Agent:", response)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å†…å¾ªç¯                             â”‚
â”‚  for iteration in range(max_iterations):                â”‚
â”‚      response = api_call(messages, tools)               â”‚
â”‚      if æ²¡æœ‰ tool_calls:                                 â”‚
â”‚          return response        â† é€€å‡ºå†…å¾ªç¯            â”‚
â”‚      for tool in tool_calls:                            â”‚
â”‚          result = execute_tool(tool)                    â”‚
â”‚          messages.append(result)                        â”‚
â”‚      # ç»§ç»­å¾ªç¯ â†’ API å¤„ç†å·¥å…·ç»“æœ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

- **`TOOLS`**ï¼šå·¥å…·åç§°åˆ°ï¼ˆæè¿°ã€å‚æ•°å®šä¹‰ã€å‡½æ•°ï¼‰å…ƒç»„çš„å­—å…¸
- **`ToolAgent`**ï¼šå¤„ç† API é€šä¿¡å’Œå·¥å…·æ‰§è¡Œçš„ä¸» Agent ç±»
- **`build_openai_tools()`**ï¼šå°†å†…éƒ¨å·¥å…·æ ¼å¼è½¬æ¢ä¸º OpenAI å‡½æ•°æ ¼å¼
- **`execute_tool()`**ï¼šåˆ†å‘å·¥å…·è°ƒç”¨åˆ°å®é™…å®ç°

## ç¯å¢ƒè¦æ±‚

- Python 3.10+
- `openai` åº“
- `python-dotenv`ï¼ˆå¯é€‰ï¼Œç”¨äº `.env` æ–‡ä»¶æ”¯æŒï¼‰
